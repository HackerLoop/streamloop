<!DOCTYPE html>
<html>
<head>
  <title>Pimp My Stream Pierre Croce</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" type="image/x-icon" href="data:image/png;base64,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">
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
  <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>
<body>
  <div id="app">
    <!-- <div class="navbar">
      <div class="container"></div>
    </div> -->
    <div class="main">
      <div class="container is-fluid columns">
        <div class="column activity">
          <h1 class="title is-4">Activités</h1>
          <ul class="activity-list">
            <li class="activity-item" v-for="item in events.slice(0, 100)" :key="item.asset_id">
              <!-- {{item}} -->
              <div class="" v-if="item.listener == 'OnChannelPoint'">
                {{item.event.data.redemption.user.display_name}}
                a récupéré :
                {{item.event.data.redemption.reward.title}}
                <br>
                <span class="tag">{{item.event.data.timestamp}}</span>
              </div>
              <div class="" v-else-if="item.listener == 'OnSEDonation'">
                <p>
                  {{item.event.data.name || item.event.data.username}}
                  a donné :
                  {{item.event.data.amount}} €
                </p>
                <p class="content is-small">{{item.event.data.message}}</p>

              </div>
              <div class="" v-else-if="item.listener == 'OnSLDonationNoSync'">
                <p>
                  {{item.event.user}}
                  a donné :
                  {{item.event.formatted}}
                </p>
                <p class="content is-small">{{item.event.message}}</p>

              </div>
              <div class="" v-else-if="item.listener == 'OnSLTwitchSubNoSync'">
                <p>
                  {{item.event.user}}
                  s'est abonné : {{item.event.tier}}
                </p>
                <p class="content is-small">{{item.event.message}}</p>

              </div>
              <div class="" v-else-if="item.listener == 'OnSLTwitchBitsNoSync'">
                <p>
                  {{item.event.user}}
                  a donné : {{item.event.amount}} bits
                </p>
                <p class="content is-small">{{item.event.message}}</p>

              </div>
              <div v-else>
                {{item.listener}}
              </div>
            </li>
          </ul>
        </div>

        <div class="column is-three-quarters widget">
          <div class="container" v-if="widgetsData[2]">
            <h1 class="title is-4">StreamBoss</h1>
            <!-- <a target="_blank" :href="`/overlay/${user}/streamboss-bar?secret=${secret}`">
              <span class="icon has-text-info">
                <i class="fas fa-link"></i>
              </span>
              Overlay Barre de progression</a>
            <br>
            <a target="_blank" :href="`/overlay/${user}/streamboss-alert?secret=${secret}`">
              <span class="icon has-text-info">
                <i class="fas fa-link"></i>
              </span>
              Overlay Alert</a>
            <br>
            <br>
            <button class="button" type="button" @click="reloadOverlays()">Rafraichire les overlays</button>
            <br> -->
            <br>
            <div class="content">
              <h1 class="title is-5">StreamBoss: {{widgetsData[2].boss.user}}</h1>
              <h1 class="title is-5">Leaderboard</h1>
              <ol type="1">
                <li v-for="viewer in viewers.slice(0, 5)" v-if="viewer.sessionPoints > 0">
                  {{ viewer.user }} - {{ viewer.sessionPoints }}pts
                </li>
              </ol>
            </div>
            <br>
            <button class="button is-warning" type="button" @click="resetBossCounter(2)">Réinitialiser progression</button>
            <br><br>
            <form v-on:submit.prevent="updateWidget(2)">
              <table class="table is-bordered is-striped is-fullwidth">
                <tr>
                  <th>Objectif</th>
                  <th>Progression</th>
                  <th>Points par Abonné</th>
                  <th>Points par Don</th>
                  <th>Points par Bit</th>
                  <th>Points par Récompense de chaine</th>
                </tr>
                <tr>
                  <td><input type="number" step="any" v-model.number="widgetsData[2].goal"></td>
                  <td><input type="number" step="any" v-model.number="widgetsData[2].current"></td>
                  <td><input type="number" step="any" v-model.number="widgetsData[2].subscriptionPoint"></td>
                  <td><input type="number" step="any" v-model.number="widgetsData[2].donationPoint"></td>
                  <td><input type="number" step="any" v-model.number="widgetsData[2].bitsPoint"></td>
                  <td><input type="number" step="any" v-model.number="widgetsData[2].rewardPoint"></td>
                </tr>
              </table>

              <br>
              <button class="button is-primary" type="submit">Mettre à jour</button>
            </form>
          </div>
          <br>
          <br>

        </div>
      </div>
    </div>


  </div>
</body>

<script>

  var socket = io();
  const adminSocket = io('/admin');
  var app = new Vue({
    el: '#app',
    data: {
      user: null,
      secret: null,
      message: 'Hello Vue!',
      widgetsData: [],
      myWidget: null,
      resourcesGallery: [],
      events: [],
      viewers: []
    },
    created () {
      window.onbeforeunload = () => {
        socket.emit('leave', this.username);
      }

      socket.on('WIDGETS_DATA', (obj) => {
        this.widgetsData = obj;
        console.log('WIDGETS_DATA', obj);
      });

      socket.on('EVENT_LIST', (obj) => {
        console.log('EVENT_LIST',obj);
        this.events = obj;
      });

      socket.on('VIEWERS_LIST', (obj) => {
        console.log('VIEWERS_LIST', obj);
        this.viewers = obj;
      });

      // adminSocket.on('DOSSIER_LIST', (obj) => {
      //   this.resourcesGallery = obj;
      //   console.log(obj);
      // });


    },
    mounted () {
      const urlParams = new URLSearchParams(window.location.search);
      const myParam = urlParams.get('secret');
      this.secret = myParam || null;

      const path = window.location.pathname;
      this.user = path.substring(1, path.lastIndexOf('/'));

    },

    methods: {
      send() {
        socket.emit('message', {
          message: "coucou"
        });
      },

      updateWidget(index) {
        console.log(this.widgetsData[index]);
        socket.emit('UPDATE_WIDGET', this.widgetsData[index]);
      },

      resetMichelCounter(index) {
        this.widgetsData[index].count = 0;
        this.widgetsData[index].offset = 0;
        socket.emit('UPDATE_WIDGET', this.widgetsData[index]);
      },

      resetBossCounter(index) {
        adminSocket.emit('RESET_STREAMBOSS', this.widgetsData[index]);
      },

      resetDossierCounter(index) {
        this.widgetsData[index].count = 0;
        socket.emit('UPDATE_WIDGET', this.widgetsData[index]);
      },

      resetDossierRevealed(index) {
        this.widgetsData[index].revealed = [];
        socket.emit('UPDATE_WIDGET', this.widgetsData[index]);
      },

      cancelDossierRevealed(id) {
        this.widgetsData[1].revealed.splice(this.widgetsData[1].revealed.indexOf(id), 1);
        socket.emit('UPDATE_WIDGET', this.widgetsData[1]);
      },

      addDossierRevealed(id) {
        this.widgetsData[1].revealed.push(id);
        socket.emit('UPDATE_WIDGET', this.widgetsData[1]);
      },

      showWidget(widget) {
        this.myWidget.open();
      },

      testSerge(duration) {
        // socket.emit('TEST_SERGE', duration);
      },

      testDossier(type) {
        adminSocket.emit('TEST_DOSSIER', type);
      },

      reloadOverlays() {
        socket.emit('RELOAD_OVERLAYS');
      }
    }
  })
</script>

<style lang="scss" scoped>
  #app {
    /* padding: 20px; */
    /* background-color: rgb(51, 51, 68); */
  }
  .users .table td {
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .activity {
    padding-bottom: 0;
    max-width: 340px;
  }

  .activity-list {
    max-height: calc(100vh - 63px);
    overflow: auto;
  }

    .activity-item {
      border-top: 2px solid #ddd;
      padding: 10px 0;
    }

  .content {
    text-overflow: ellipsis;
    overflow: hidden;
  }

  .container.is-fluid {
    margin: 0;
    padding: 0;
  }

  .widget {
    overflow: auto;
    height: 100vh;
  }
</style>

</html>